---
title: "å€‹äººçš„ MacOS ã§ skim ã§ PDF ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ãã¾ã—ãŸï¼"
emoji: "ğŸ—’"
type: "tech"
topics: ["shell", "skim", "osascript"]
published: false
---

### èƒŒæ™¯

MacOS ã® PDF viewer ã¯ä½•ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ è‡ªåˆ†ã¯ã€PDF ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„å‡ºåŠ›ã‚’å¿…è¦ã¨ã™ã‚‹ã“ã¨ã¯ãªã‹ã£ãŸã®ã§ã€ç‰¹ã«ä½•ã‚‚ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€æœ€è¿‘ã€æ¥­å‹™ã§ãƒ‡ãƒ¼ã‚¿ãŒé›†è¨ˆã§ãã¦ããŸã®ã§åˆã‚ã›ã¦ã€çµ±è¨ˆç­‰ã‚’ã‹ã˜ã‚Šå§‹ã‚ã¾ã—ã¦ R è¨€èªã¨ã„ã†ã‚‚ã®ã«æ‰‹ã‚’å‡ºã—å§‹ã‚ãŸã®ã§ã™ãŒã€R ã® Preview ãŒ Rstudio ä¸€å¼·ãªæ„Ÿã˜ã§ã—ãŸãŒã€Vim ã§ç·¨é›†ã—ã¦ã‚·ãƒ³ãƒ—ãƒ«ã« Preview ã ã‘é–‹ããŸã„ã¨ã„ã†åˆ¶ç´„ãŒã‚ã‚‹ã®ã§ã€RStudio ä½¿ã„ã¾ã›ã‚“ã€‚plot ã® Preview ã¨ã‹ã‚’ PDF ã«å‡ºåŠ›ã—ã¦è¦‹ãŸã„ã¨è¨€ã†è¦ä»¶ã«ãªã‚Šã¾ã—ãŸã€‚åŒæ™‚ã« Latex ã‚„ RMarkdown ã‚‚ç’°å¢ƒæ§‹ç¯‰ã ã‘ã—ã¾ã—ãŸãŒã€ã“ã¡ã‚‰ã‚‚ Preview ã®å‡ºåŠ›ãŒ PDF ã¿ãŸã„ãªæ„Ÿã˜ã§ã—ãŸã®ã§ CLI base ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒå¿…è¦ã¨ãªã‚Šã¾ã—ãŸã€‚MacOS ã®æ¨™æº–ã® Preview app ã§ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã§ã™ã—ã€PDF å†å‡ºåŠ›å¾Œã«ä¸€åº¦ Previewr app ã« focus ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†æ„Ÿã˜ã§ã—ãŸã€‚ [Skim](https://sourceforge.net/projects/skim-app/) ã¨ã„ã†ã‚‚ã®ã‚’è¦‹ã¤ã‘ã¦æƒ…å ±ãŒå¤šãã†ãªã®ã¨æ©Ÿèƒ½ãŒè‰¯ã•ãã†ãªã®ã§ä½¿ã„å§‹ã‚ã¾ã—ãŸã€‚æ©Ÿèƒ½è‡ªä½“ã¾ã å…¨ç„¶ä½¿ã„ã“ãªã›ã¦ã„ã¾ã›ã‚“ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ãŒã‚ã‚‹ãã†ã§ã™ã€‚

\ Viewing PDFs \ Adding and editing notes \ Highlighting important text, including one-swipe highlight modes \ Making "snapshots" for easy reference \ Navigation using table of contents or thumbnails, with visual history \ View all your notes and highlights \ Convenient reading in full screen \ Giving powerful presentations, with built-in transitions \ Handy preview of internal links \ Focus using a reading bar \ Magnification tool \ Smart cropping tools \ Extensive AppleScript support \ Bookmarks \ And much more... \

Skim ã‚’ä½¿ã„å§‹ã‚ãŸã¯ã„ã„ã‚‚ã®ã®ã€PDF å†å‡ºåŠ›å¾Œã« SKim Application ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦ã‚‚è¡¨ç¤ºå†…å®¹ãŒå‡ºåŠ›ã•ã‚Œãªã„ã®ã§ã™ã€‚ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã« `Skim ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã§ã¯ãªããƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½è·¡ã™ã‚‹ãŸã‚ã€PDF ãƒ•ã‚¡ã‚¤ãƒ«ãŒç½®ãæ›ãˆã‚‰ã‚Œã‚‹å‰ã«å‰Šé™¤ã•ã‚Œã‚‹ã¨ã€Skim ã®è‡ªå‹•ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¯ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚` ã¨ã®äº‹ã§ã™ã€ç¢ºå®Ÿã«ãƒªãƒ­ãƒ¼ãƒ‰ã‚’ã—ãŸã„ãªã‚‰ã€PDF å†ä½œæˆå¾Œã«æ‰‹å‹•ã§é–‹ãç›´ã™ã‹ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§é–‹ãç›´ã™å¿…è¦ãŒã‚ã‚‹ãã†ã§ã™ã€‚ã¨ã«ã‹ãã€å€‹äººçš„ã«ã¯ã€ä»¥ä¸‹ã® sample ã® applescript ã‚’å‚è€ƒã« wrap ã—ã¦ã€Vim ã‹ã‚‰å‘¼ã³å‡ºã›ã°ã„ã„ã¨ã„ã†çµè«–ã«ãªã‚Šã¾ã—ãŸã€‚

[Skim / Wiki / TeX_and_PDF_Synchronization](https://sourceforge.net/p/skim-app/wiki/TeX_and_PDF_Synchronization/)

> Reload updated PDF files
> Skim can recognize when the PDF file is updated on disk, for example by a LaTeX process. Skim then offers to reload the file. If you choose Auto from the dialog, Skim will reload this document without asking for future updates.
> Use this feature with care, as reloading the file will typically lose any notes. If you have unsaved edits, Skim will always ask you whether to reload, even if you have previously chosen Auto. When you choose No, you can still reload manually by choosing Revert from the File menu.
> This feature should be turned on in the LaTeX preferences.
> Even though we offer this feature, we discourage you from using it. In general, the only reliable way to automatically reload the document is by triggering the reload yourself from a script as the one below, which therefore is the preferred approach.
> Note: Skim's automatic file updating mechanism gets disabled when the PDF file is deleted before it is replaced, because Skim tracks the file object rather than the location of the file. This is by design for good reasons, and it is the way any document based Cocoa application works. Some TeX scripts (e.g. simpdftex) remove the PDF file, and therefore Skim will not automatically reload the file produced by such processes.
> Note: The auto-reload functionality will not work properly when you have to run a latex process more than once, for example to support references generated by bibtex, because Skim will be trying to reload the document when the second latex process is busy. You could instead run latex and bibtex together with forcing a Skim reload using the script below.

### ã‚µãƒ³ãƒ—ãƒ«ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

Current directory ã® \*.tex ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ pdflatex && bibtex ã—ã¦ã€ Current directory \*.pdf ã«å‡ºåŠ›ã—ã¾ã™ã€‚ãã®å¾Œã€pdffile ã‚’é–‹ãç›´ã—ã¾ã™ã€‚ã“ã®ã¾ã¾ã§ã¯ã€Current directory ã« PDF ä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«(\*.aux \*.bbl \*ablg \*.log \*.pdf)ç­‰ã€è‰²ã€…å‡ºåŠ›ã•ã‚Œã¦å°‘ã—ã†ã–ã„ãªã¨æ€ã£ãŸã®ã§ã€/tmp ã«å‡ºåŠ›ã—ãŸã»ã†ãŒã„ã„ãªã¨æ€ã„ã¾ã—ãŸã€‚ ã¾ãŸã€Skim ã‚’ã€€ activate ã™ã‚‹ã¨ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚Œã€æ¯å›ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã« ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã•ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ãã‚Œã‚‚è‡ªå‹•ã§ã‚„ã£ã¦ã—ã¾ã—ãŸã„ã§ã™ã­ã€ã‚ã¨ã¯ã€Latex ä»¥å¤–ã®å¤‰æ›ã‚‚æä¾›ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå¿…è¦ã ãªã¨æ€ã„ã¾ã—ãŸã€‚

```applescript
!/bin/bash

# the first argument should be the tex file, either with or without extension
file="$1"
[ "${file:0:1}" == "/" ] || file="${PWD}/${file}"
pdffile="${file%.tex}.pdf"

# run pdflatex and bibtex, and open or reload the pdf  in Skim
pdflatex "${file}" && bibtex "${file}" && pdflatex "${file}" && pdflatex "${file}" && \
/usr/bin/osascript << EOF
  set theFile to POSIX file "${pdffile}" as alias
  tell application "Skim"
  activate
  set theDocs to get documents whose path is (get POSIX path of theFile)
  if (count of theDocs) > 0 then revert theDocs
  open theFile
  end tell
EOF
```

### ã‚¤ãƒ¡ãƒ¼ã‚¸

![skim gif](/images/skim.gif)

##### OSAscript

```applescript
#!/bin/bash
FOCUS=false
PDF_FILE=""

open_skim() {
	/usr/bin/osascript <<EOF
  set theFile to POSIX file "$PDF_FILE" as alias
  tell application "Skim"
    activate
    set theDocs to get documents whose path is (get POSIX path of theFile)
    if (count of theDocs) > 0 then revert theDocs
      open theFile
  end tell
  tell application "$CURRENT_TERM"
    if ${FOCUS} then
    else
      activate
    end if
  end tell
EOF
}

current_term() {
	/usr/bin/osascript <<EOF
  tell application "System Events"
    set activeApp to name of first application process whose frontmost is true
  end tell
  return {activeApp}
EOF
}
```

##### Vim

[GitHub - skywind3000/asyncrun.vim: Run Async Shell Commands in Vim 8.0 / NeoVim and Output to the Quickfix Window !!](https://github.com/skywind3000/asyncrun.vim)

```vim
function! s:skimPDFLatex()
  let absolutePath=expand('%:p')
  let cmd = "AsyncRun skim_reload -s pdflatex " . absolutePath
  silent execute cmd
endfunction

function! s:skimRPlot()
  let absolutePath=expand('%:p')
  let cmd = "AsyncRun skim_reload -s rplot " . absolutePath
  silent execute cmd
endfunction

function! s:skimRMarkdown()
  let absolutePath=expand('%:p')
  let cmd = "AsyncRun skim_reload -s rmd " . absolutePath
  silent execute cmd
endfunction

autocmd BufEnter *.rmd nnoremap <silent> sk :call <SID>skimRMarkdown()<CR>
autocmd BufEnter *.r nnoremap <silent> sk :call <SID>skimRPlot()<CR>
autocmd BufEnter *.tex nnoremap <silent> sk :call <SID>skimPDFLatex()<CR>
```

##### Source code

ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨è¡Œã§ã™ã€‚/usr/local/bin/skim_reload ã¨ã‹ã«ç½®ã„ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```bash
#!/bin/bash

# this script convert .pdf and reload skim.app.
# you can expansion, resolve path, customize converter.
# referenced: https://sourceforge.net/p/skim-app/wiki/TeX_and_PDF_Synchronization.

open_skim() {
	/usr/bin/osascript <<EOF
  set theFile to POSIX file "$PDF_FILE" as alias
  tell application "Skim"
    activate
    set theDocs to get documents whose path is (get POSIX path of theFile)
    if (count of theDocs) > 0 then revert theDocs
      open theFile
  end tell
  tell application "$CURRENT_TERM"
    if ${FOCUS} then
    else
      activate
    end if
  end tell
EOF
}

current_term() {
	/usr/bin/osascript <<EOF
  tell application "System Events"
    set activeApp to name of first application process whose frontmost is true
  end tell
  return {activeApp}
EOF
}

# Initialize global variables
SILENT=false
CURRENT_TERM="$(current_term)"
FOCUS=false
POSITIONAL_ARGS=()
FILE=""
FILE_BASE=""
FILE_NAME=""
FILE_EXTENSION=""
DIR_BASE=""
PDF_FILE=""

# parse flags
while [[ $# -gt 0 ]]; do
	case $1 in
	-s | --silent)
		SILENT=true
		shift
		;;
	-f | --focus)
		FOCUS=true
		shift
		;;
	*)
		POSITIONAL_ARGS+=("$1")
		shift
		;;
	esac
done

set -- "${POSITIONAL_ARGS[@]}"

run_skim() {
	FILE="$2"
	if [[ ! -e "$FILE" ]]; then
		printf "File not found %s" "$FILE" 1>&2
	fi

	DIR_BASE="$3"
	if [[ -z "$DIR_BASE" ]]; then
		DIR_BASE="/tmp"
	fi
	FILE="$(realpath "$FILE")"
	FILE_NAME="$(basename "${FILE%.*}")"
	FILE_EXTENSION="${FILE##*.}"

	case "$1" in
	"pdflatex")
		if [[ $(echo "$FILE_EXTENSION" | tr "[:lower:]" "[:upper:]") != "TEX" ]]; then
			printf "File extension is not .tex %s" "$FILE_BASE" 1>&2
			exit 1
		fi
		FILE_BASE="$FILE_NAME.pdf"
		PDF_FILE="$DIR_BASE/$FILE_BASE"
		pdflatex -output-directory=${DIR_BASE} -interaction nonstopmode "$FILE" && bibtex "$FILE"
		if [[ -e "$PDF_FILE" ]]; then
			open_skim
		else
			printf "File not found %s" "$PDF_FILE" 1>&2
		fi
		;;
	"rplot")
		if [[ $(echo "$FILE_EXTENSION" | tr "[:lower:]" "[:upper:]") != "R" ]]; then
			printf "File extension is not .r %s" "$FILE_BASE" 1>&2
			exit 1
		fi
		cp -f "$FILE" "$DIR_BASE"
		FILE="$FILE_NAME.r"
		FILE_BASE="$FILE_NAME.pdf"
		PDF_FILE="$DIR_BASE/Rplots.pdf"
		# shellcheck disable=SC2164
		cd "$DIR_BASE"
		rscript "$FILE"
		if [[ -e "$PDF_FILE" ]]; then
			open_skim
		else
			printf "File not found %s" "$PDF_FILE" 1>&2
		fi
		;;
	"rmd")
		if [[ $(echo "$FILE_EXTENSION" | tr "[:lower:]" "[:upper:]") != "RMD" ]]; then
			printf "File type not .rmd %s" "$FILE_BASE" 1>&2
			exit 1
		fi
		FILE_BASE="$FILE_NAME.pdf"
		PDF_FILE="$DIR_BASE/$FILE_NAME.pdf"
		local q
		q="$(
			cat <<EOF
rmarkdown::render("$FILE", rmarkdown::pdf_document(), "$DIR_BASE/$FILE_NAME")
EOF
		)"
		R -e "$q"
		if [[ -e "$PDF_FILE" ]]; then
			open_skim
		else
			printf "File not found %s" "$PDF_FILE" 1>&2
		fi
		;;
	*)
		printf "Type not found %s\n" "$1" 1>&2
		help
		exit 0
		;;
	esac
}

if [[ $SILENT == true ]]; then
	run_skim "$@" >/dev/null
else
	run_skim "$@"
fi
```
